<form name="passholderNewCard" ng-submit="rcc.submitForm(passholderNewCard)" novalidate ng-class="{'form-submiting': rcc.formSubmitBusy}">
  <div class="modal-header">
    <button type="button" class="close" ng-click="rcc.cancelModal()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Kaart vervangen</h4>
  </div>
  <div class="modal-body">
    <div class="container-fluid">

      <p class="direction">
        Scan de nieuwe UiTPAS of vul het kaartnummer manueel in.
      </p>

      <div class="grid">
        <div class="grid__12 grid--bp-xsm__10">
          <!-- @TODO: input field stays red after it has been invalid, even with a correct value -->
          <div class="form-group" ng-class="{ 'has-error': (passholderNewCard.$submitted || passholderNewCard.UitpasNr.$dirty) && passholderNewCard.UitpasNr.$invalid }">
            <label for="UiTPASnummer" class="label-nummer">UiTPAS-nummer</label>
            <input type="text" class="form-control input-nummer" name="UitpasNr"
            id="UiTPASnummer" autofocus="" ng-required="true"
            ng-model="rcc.card.id" ng-blur="rcc.checkUiTPAS(passholderNewCard)">
            <div ng-if="(passholderNewCard.$submitted || passholderNewCard.UitpasNr.$touched || passholderNewCard.UitpasNr.$dirty) && passholderNewCard.UitpasNr.$invalid" class="text-danger small">
              <div ng-if="passholderNewCard.UitpasNr.$error.isNotFound">Deze kaart zit niet in de locale stock van kaarten.</div>
              <div ng-if="passholderNewCard.UitpasNr.$error.isUsed">Deze kaart zit niet in de locale stock van kaarten.</div>
              <div ng-if="passholderNewCard.UitpasNr.$error.notKansStatuut">Deze kaart heeft niet het KansStatuut.</div>
              <div ng-if="passholderNewCard.UitpasNr.$error.isKansStatuut">Deze kaart heeft het KansStatuut.</div>
            </div>
          </div>
        </div>
        <div class="grid__12 grid--bp-xsm__2">
          <span class="icon icon--small icon--card-scan"></span>
        </div>
      </div>
      <hr>
      <label>Reden</label>
      <div ng-repeat="reason in rcc.reasons" class="radio">
        <label>
          <input type="radio" name="optradio" ng-model="rcc.card.reason"
          value="{{reason.code}}" ng-required="true"
          ng-change="rcc.getPassPrice(passholderNewCard)">
          {{reason.description}}
        </label>
      </div>
      <hr>
        <div ng-if="rcc.card.reason == 'OBTAIN_KANSENSTATUUT'">
        <ubr-datepicker
          ng-model="rcc.kansenstatuut.endDate"
          ubr-label="Kansenstatuut geldig tot"
          ubr-id="geldig-tot"
          ubr-name="endDate"></ubr-datepicker>
        <hr>
      </div>
      <div class="checkbox">
        <label>
          <input type="checkbox" class="gebruik-voucher" ng-model="_useVoucher"> Gebruik voucher
        </label>
      </div>
      <div class="panel voucher" ng-if="_useVoucher">
        <div class="panel-body">
          <div class="form-group" ng-class="{ 'has-error': (passholderNewCard.$submitted || passholderNewCard.voucher.$dirty) && passholderNewCard.voucher.$invalid }">
            <label>Voucher-nummer</label>
            <input class="form-control voucher-nummer"  name="voucher"
            ng-model="rcc.card.voucher" autofocus="autofocus" ng-required="true"
            ng-blur="rcc.getPassPrice(passholderNewCard)">
            <!-- @TODO: ng-blur isn't a great way, ng-change is even worse -->
          </div>
        </div>
        <p ng-if="rcc.voucherType"><strong>Voucher Type:</strong><br>{{rcc.voucherType}}</p>
      </div>
      <div ng-show="rcc.price || rcc.price === 0">
        <label>Prijs</label>
        <p>
          <span ng-if="rcc.price>0" class="price">{{rcc.price|number:2}} euro</span>
          <span ng-if="rcc.price==0" class="price">Gratis!</span>
        </p>
      </div>

    </div>
  </div><!-- end modal-body -->
  <div class="modal-footer">
    <a ng-click="rcc.cancelModal()">Annuleren</a>
    <button type="button" class="btn btn-primary" ng-disabled="rcc.formSubmitBusy || passholderNewCard.$invalid" ng-click="rcc.submitForm(passholderNewCard)">
      <span ng-hide="rcc.formSubmitBusy">Bewaren</span>
      <span ng-show="rcc.formSubmitBusy">
        <span class="fa fa-refresh loading small"></span>
        Formulier wordt verzonden
      </span>
    </button>
  </div>
</form>
